<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Movie Recommendation System</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <header>
            <h1>Intelligent Movie Recommendations</h1>
            <p class="subtitle">Discover movies you'll love using advanced recommendation algorithms</p>
        </header>

        <main>
            <section class="selection-panel">
                <h2>Select a Movie</h2>
                <div class="form-group">
                    <label for="movie-select">Choose a movie to get recommendations:</label>
                    <select id="movie-select">
                        <option value="">-- Select a movie --</option>
                        {% for movie in movies %}
                        <option value="{{ movie.movieId }}" data-genres="{{ movie.genres }}">
                            {{ movie.title }}
                        </option>
                        {% endfor %}
                    </select>
                </div>

                <div class="form-group">
                    <label>Recommendation Method:</label>
                    <div class="method-buttons">
                        <button class="method-btn active" data-method="hybrid">
                            <span class="icon">&#x2728;</span>
                            Hybrid
                            <span class="desc">Best of both worlds</span>
                        </button>
                        <button class="method-btn" data-method="content">
                            <span class="icon">&#x1F3AC;</span>
                            Content-Based
                            <span class="desc">Similar genres</span>
                        </button>
                        <button class="method-btn" data-method="collaborative">
                            <span class="icon">&#x1F465;</span>
                            Collaborative
                            <span class="desc">User preferences</span>
                        </button>
                    </div>
                </div>

                <button id="get-recommendations" class="primary-btn" disabled>
                    Get Recommendations
                </button>
            </section>

            <section id="source-movie" class="source-panel hidden">
                <h3>Selected Movie</h3>
                <div class="movie-card source">
                    <h4 id="source-title"></h4>
                    <p class="genres" id="source-genres"></p>
                </div>
            </section>

            <section id="results" class="results-panel hidden">
                <h2>Recommended Movies</h2>
                <p id="method-explanation" class="method-info"></p>
                <div id="recommendations-list" class="recommendations-grid">
                </div>
            </section>

            <section class="info-panel">
                <h3>How It Works</h3>
                <div class="info-cards">
                    <div class="info-card">
                        <h4>Content-Based Filtering</h4>
                        <p>Analyzes movie genres using TF-IDF (Term Frequency-Inverse Document Frequency) and cosine similarity. Movies with similar genre profiles are recommended.</p>
                    </div>
                    <div class="info-card">
                        <h4>Collaborative Filtering</h4>
                        <p>Identifies movies that users with similar tastes enjoyed. If users who liked Movie A also liked Movie B, these movies are considered similar.</p>
                    </div>
                    <div class="info-card">
                        <h4>Hybrid System</h4>
                        <p>Combines both approaches for more robust recommendations. This balances genre similarity with actual user preferences.</p>
                    </div>
                </div>
            </section>
        </main>

        <footer>
            <p>Intelligent Movie Recommendation System</p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const movieSelect = document.getElementById('movie-select');
            const getRecsBtn = document.getElementById('get-recommendations');
            const methodBtns = document.querySelectorAll('.method-btn');
            const resultsSection = document.getElementById('results');
            const sourceSection = document.getElementById('source-movie');
            const recsList = document.getElementById('recommendations-list');
            
            let selectedMethod = 'hybrid';

            movieSelect.addEventListener('change', function() {
                getRecsBtn.disabled = !this.value;
            });

            methodBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    methodBtns.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    selectedMethod = this.dataset.method;
                });
            });

            getRecsBtn.addEventListener('click', async function() {
                const movieId = movieSelect.value;
                if (!movieId) return;

                getRecsBtn.disabled = true;
                getRecsBtn.textContent = 'Loading...';

                try {
                    const response = await fetch('/api/recommend', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            movie_id: parseInt(movieId),
                            method: selectedMethod
                        })
                    });

                    const data = await response.json();
                    displayResults(data);
                } catch (error) {
                    console.error('Error:', error);
                    recsList.innerHTML = '<p class="error">Failed to get recommendations. Please try again.</p>';
                } finally {
                    getRecsBtn.disabled = false;
                    getRecsBtn.textContent = 'Get Recommendations';
                }
            });

            function displayResults(data) {
                document.getElementById('source-title').textContent = data.source_movie.title;
                document.getElementById('source-genres').textContent = data.source_movie.genres.replace(/\|/g, ' | ');
                sourceSection.classList.remove('hidden');

                const methodExplanations = {
                    'hybrid': 'Combining genre similarity and user preferences for balanced recommendations',
                    'content': 'Recommending movies with similar genres using TF-IDF analysis',
                    'collaborative': 'Recommending movies based on similar user rating patterns'
                };
                document.getElementById('method-explanation').textContent = methodExplanations[data.method];

                if (data.recommendations.length === 0) {
                    recsList.innerHTML = '<p class="no-results">No recommendations found for this movie with the selected method.</p>';
                } else {
                    recsList.innerHTML = data.recommendations.map((rec, index) => `
                        <div class="recommendation-card" style="animation-delay: ${index * 0.1}s">
                            <div class="rank">#${index + 1}</div>
                            <h4 class="rec-title">${rec.title}</h4>
                            <p class="rec-genres">${rec.genres.replace(/\|/g, ' | ')}</p>
                            <div class="score-badge">
                                Score: ${(rec.score * 100).toFixed(1)}%
                            </div>
                            <div class="reason">
                                <strong>Why recommended:</strong>
                                <p>${rec.reason}</p>
                            </div>
                            ${rec.method === 'hybrid' ? `
                                <div class="score-breakdown">
                                    <span class="content-score">Genre: ${(rec.content_score * 100).toFixed(0)}%</span>
                                    <span class="collab-score">Users: ${(rec.collab_score * 100).toFixed(0)}%</span>
                                </div>
                            ` : ''}
                        </div>
                    `).join('');
                }

                resultsSection.classList.remove('hidden');
                resultsSection.scrollIntoView({ behavior: 'smooth' });
            }
        });
    </script>
</body>
</html>
