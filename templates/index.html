<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Akıllı Film Öneri Sistemi</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <div class="container">
        <header>
            <h1>Akıllı Film Öneri Sistemi</h1>
            <p class="subtitle">Gelişmiş algoritmalar ile size özel film önerileri keşfedin</p>
        </header>

        <main>
            <section class="selection-panel">
                <h2>Film Seçin</h2>
                <div class="form-group">
                    <label for="movie-select">Öneri almak istediğiniz filmi seçin:</label>
                    <select id="movie-select">
                        <option value="">-- Film seçin --</option>
                        {% for movie in movies %}
                        <option value="{{ movie.movieId }}" data-genres="{{ movie.genres }}">
                            {{ movie.title }}
                        </option>
                        {% endfor %}
                    </select>
                </div>

                <div class="form-group">
                    <label>Öneri Yöntemi:</label>
                    <div class="method-buttons">
                        <button class="method-btn active" data-method="hybrid">
                            <span class="icon">&#x2728;</span>
                            Hibrit Sistem
                            <span class="desc">En iyi sonuç için iki yöntem birleşik</span>
                        </button>
                        <button class="method-btn" data-method="content">
                            <span class="icon">&#x1F3AC;</span>
                            İçerik Tabanlı
                            <span class="desc">Benzer türler ve içerik</span>
                        </button>
                        <button class="method-btn" data-method="collaborative">
                            <span class="icon">&#x1F465;</span>
                            İşbirlikçi Filtreleme
                            <span class="desc">Benzer kullanıcıların tercihleri</span>
                        </button>
                    </div>
                </div>

                <button id="get-recommendations" class="primary-btn" disabled>
                    Önerileri Getir
                </button>
            </section>

            <section id="source-movie" class="source-panel hidden">
                <h3>Seçilen Film</h3>
                <div class="movie-card source">
                    <h4 id="source-title"></h4>
                    <p class="genres" id="source-genres"></p>
                </div>
            </section>

            <section id="results" class="results-panel hidden">
                <h2>Önerilen Filmler</h2>
                <p id="method-explanation" class="method-info"></p>
                <div id="recommendations-list" class="recommendations-grid">
                </div>
            </section>
        </main>

        <footer>
            <p>Akıllı Film Öneri Sistemi - Kişiselleştirilmiş önerilerle film keşfedin</p>
        </footer>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const movieSelect = document.getElementById('movie-select');
            const getRecsBtn = document.getElementById('get-recommendations');
            const methodBtns = document.querySelectorAll('.method-btn');
            const resultsSection = document.getElementById('results');
            const sourceSection = document.getElementById('source-movie');
            const recsList = document.getElementById('recommendations-list');
            
            let selectedMethod = 'hybrid';

            movieSelect.addEventListener('change', function() {
                getRecsBtn.disabled = !this.value;
            });

            methodBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    methodBtns.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    selectedMethod = this.dataset.method;
                });
            });

            getRecsBtn.addEventListener('click', async function() {
                const movieId = movieSelect.value;
                if (!movieId) return;

                getRecsBtn.disabled = true;
                getRecsBtn.textContent = 'Yükleniyor...';

                try {
                    const response = await fetch('/api/recommend', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            movie_id: parseInt(movieId),
                            method: selectedMethod
                        })
                    });

                    const data = await response.json();
                    displayResults(data);
                } catch (error) {
                    console.error('Error:', error);
                    recsList.innerHTML = '<p class="error">Öneriler alınamadı. Lütfen tekrar deneyin.</p>';
                } finally {
                    getRecsBtn.disabled = false;
                    getRecsBtn.textContent = 'Önerileri Getir';
                }
            });

            function displayResults(data) {
                document.getElementById('source-title').textContent = data.source_movie.title;
                document.getElementById('source-genres').textContent = data.source_movie.genres.replace(/\|/g, ' | ');
                sourceSection.classList.remove('hidden');

                const methodExplanations = {
                    'hybrid': 'Hem tür benzerliği hem de kullanıcı tercihleri birleştirilerek dengeli öneriler sunuluyor',
                    'content': 'TF-IDF analizi ile benzer türlerdeki filmler öneriliyor',
                    'collaborative': 'Benzer kullanıcıların puanlama kalıplarına göre filmler öneriliyor'
                };
                document.getElementById('method-explanation').textContent = methodExplanations[data.method];

                if (data.recommendations.length === 0) {
                    recsList.innerHTML = '<p class="no-results">Bu film için seçilen yöntemle öneri bulunamadı.</p>';
                } else {
                    recsList.innerHTML = data.recommendations.map((rec, index) => `
                        <div class="recommendation-card" style="animation-delay: ${index * 0.1}s">
                            <div class="rank">#${index + 1}</div>
                            <h4 class="rec-title">${rec.title}</h4>
                            <p class="rec-genres">${rec.genres.replace(/\|/g, ' | ')}</p>
                            <div class="score-badge">
                                Benzerlik: ${(rec.score * 100).toFixed(1)}%
                            </div>
                            <div class="explanation-box">
                                <div class="explanation-header">
                                    <span class="explanation-icon">&#x1F4A1;</span>
                                    <strong>Bu Film Neden Öneriliyor?</strong>
                                </div>
                                <p class="explanation-text">${rec.explanation}</p>
                                ${rec.detailed_reason ? `<p class="detailed-reason">${rec.detailed_reason}</p>` : ''}
                            </div>
                            ${rec.method === 'hybrid' ? `
                                <div class="score-breakdown">
                                    <div class="score-item content">
                                        <span class="score-label">İçerik Benzerliği</span>
                                        <span class="score-value">${(rec.content_score * 100).toFixed(0)}%</span>
                                    </div>
                                    <div class="score-item collab">
                                        <span class="score-label">Kullanıcı Tercihi</span>
                                        <span class="score-value">${(rec.collab_score * 100).toFixed(0)}%</span>
                                    </div>
                                </div>
                            ` : ''}
                        </div>
                    `).join('');
                }

                resultsSection.classList.remove('hidden');
                resultsSection.scrollIntoView({ behavior: 'smooth' });
            }
        });
    </script>
</body>
</html>
